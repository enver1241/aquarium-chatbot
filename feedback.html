<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="feedback.title">Feedback - AquaLifeAI</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
  <style>
    .container{max-width:900px;margin:40px auto;padding:20px}
    .card{background:#fff;border-radius:16px;padding:28px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
    label{display:block;margin:14px 0 6px;font-weight:600}
    input,textarea{width:100%;padding:14px;border:1px solid #e2e8f0;border-radius:12px;font-size:16px}
    textarea{min-height:140px;resize:vertical}
    .btn{width:100%;padding:16px;border:none;border-radius:14px;font-size:18px;font-weight:700;cursor:pointer;background:linear-gradient(90deg,#2563eb,#1e40af);color:#fff}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .brand img{width:40px;height:40px;object-fit:contain;touch-action:manipulation;-webkit-user-drag:none;user-select:none}
    .hint{color:#6b7280;font-size:14px;margin-top:6px}
    .error{color:#b91c1c;margin-top:10px}
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background-color: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    .nav-links {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .nav-links a {
      text-decoration: none;
      color: #1e40af;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
    }
    .nav-links a:hover {
      background-color: #e0f2fe;
    }
    .nav-links a[aria-current="page"] {
      background-color: #dbeafe;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <a href="index.html" style="display: flex; align-items: center; text-decoration: none;">
        <img src="aqualifeai.png" alt="AquaLifeAI Logo" class="brand-logo" />
        <strong style="margin-left: 10px; color: #1e40af;" data-i18n="nav.brand">AquaLifeAI</strong>
      </a>
    </div>

    <button class="nav-toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="navMenu">
      <img src="aqualifeai.png" alt="Menu" class="nav-toggle-logo" />
    </button>

    <nav id="navMenu" class="nav-links" role="navigation">
      <a href="index.html" data-i18n="nav.home">Home</a>
      <a href="Chatbot.html" data-i18n="nav.chatbot">Chatbot</a>
      <a href="feedback.html" style="background:#eef2ff" data-i18n="nav.feedback" aria-current="page">Feedback</a>
      <a id="logoutBtn" class="btn btn-outline" href="#" data-i18n="nav.logout">Logout</a>
      <button id="langToggle" class="btn btn-outline" aria-label="Toggle language">üåê</button>
    </nav>
  </header>

  <div class="container">
    <div class="brand">
      <h1 data-i18n="feedback.heading">Send us your Feedback</h1>
    </div>

    <div class="card">
      <form id="feedbackForm" novalidate>
        <label for="name" data-i18n="feedback.form.name">Your Name *</label>
        <input 
          id="name" 
          name="name" 
          type="text" 
          data-i18n-placeholder="feedback.placeholder.name" 
          placeholder="Your name" 
          required 
        />

        <label for="email" data-i18n="feedback.form.email">Your Email *</label>
        <input 
          id="email" 
          name="email" 
          type="email" 
          data-i18n-placeholder="feedback.placeholder.email" 
          placeholder="you@example.com" 
          required 
        />

        <label for="message" data-i18n="feedback.form.message">Message / Issue *</label>
        <textarea 
          id="message" 
          name="message" 
          data-i18n-placeholder="feedback.placeholder.message" 
          placeholder="Tell us what's up..." 
          required
        ></textarea>

        <p class="hint" data-i18n="feedback.hint">We store your feedback securely to improve AquaLifeAI.</p>
        <button class="btn" type="submit" data-i18n="feedback.submit">Send Message</button>
        <div id="err" class="error" style="display:none"></div>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('feedbackForm');
      const err = document.getElementById('err');
      
      // Get translations
      function getTranslation(key) {
        const currentLang = localStorage.getItem('preferredLanguage') || 'en';
        const translations = window.translations || {};
        return (translations[currentLang]?.[key] || translations['en']?.[key] || key);
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        err.style.display = 'none';

        const btn = form.querySelector('button[type="submit"]');
        const originalBtnText = btn.textContent;
        btn.disabled = true; 
        btn.textContent = getTranslation('feedback.sending');

        const payload = {
          name: form.name.value.trim(),
          email: form.email.value.trim(),
          message: form.message.value.trim()
        };

        if(!payload.name || !payload.email || !payload.message) {
          err.textContent = getTranslation('feedback.error.required');
          err.style.display = 'block';
          btn.disabled = false; 
          btn.textContent = originalBtnText;
          return;
        }

        try {
          const res = await fetch('/api/feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (res.ok || res.redirected || res.status === 303) {
            window.location.href = 'thanks.html';
            return;
          }
          
          const text = await res.text();
          throw new Error(text || ('HTTP ' + res.status));
          
        } catch (ex) {
          console.error('Feedback submission error:', ex);
          err.textContent = getTranslation('feedback.error.submission') + ': ' + ex.message;
          err.style.display = 'block';
        } finally {
          btn.disabled = false;
          btn.textContent = originalBtnText;
        }
      });
    });
  </script>
</body>
</html>
